<% provide(:title, 'User Settings') %>
<div class="row">
  <div class="span12 page-body">
    <div class="page-header">
      <h2>Edit User Settings</h2>
    </div>

    <div class="page-content">
      <div class="tabbable tabs-left tabs-settings">
        <ul class="nav nav-tabs">
          <li class="active"><a href="#accounts" data-toggle="tab">Linked Accounts</a></li>
          <li><a href="#profile" data-toggle="tab">Profile Information</a></li>
          <li><a href="#password" data-toggle="tab">Email and Password</a></li>
        </ul>
        <div class="tab-content">
          <div class="tab-pane active" id="accounts">
            <h3>Linked Accounts</h3>
            <table class="table table-bordered table-striped">
              <tr>
                <th>Account Provider</th>
                <th>Status</th>
                <th>Actions</th>
              </tr>
              <% ["facebook", "twitter", "dwolla"].each do |provider| %>
                <tr>
                  <td><%= provider.capitalize %></td>
                  <td>
                    <% if !current_user.send(provider) %>
                      <span class="danger">Unlinked</span>
                    <% else %>
                      <span class="success">Linked</span>
                    <% end %>
                  </td>
                  <td>
                    <% if !current_user.send(provider) %>
                      <%= link_to "Link Account", "/users/auth/#{provider}", class: "btn btn-primary" %>
                    <% else %>
                      <%= link_to "Unlink Account", linked_account_path(current_user.send(provider)), class: "btn btn-danger", confirm: "Are you sure that you wish to unlink this account?", method: :delete %>
                    <% end %>
                  </td>
                </tr>
              <% end %>
            </table>
          </div>
          <div class="tab-pane" id="profile">
            <h3>Profile Information</h3>
          </div>
          <div class="tab-pane" id="password">
            <h3>Email and Password</h3>
            <% resource_name = "user" %>
            <%= form_for(current_user, :as => resource_name, :url => registration_path(resource_name), :html => { :method => :put }) do |f| %>
              <%= devise_error_messages(@errors) %>
              
              <div class="control-group">
                <%= f.label :email, class: 'control-label' %>
                <div class="controls">
                  <%= f.email_field :email %>
                </div>
              </div>

              <div class="control-group">
                <%= f.label :password %> <i class: 'control-label'>(leave blank if you don't want to change it)</i>
                <div class="controls">
                  <%= f.password_field :password, :autocomplete => "off" %>
                </div>
              </div>

              <div class="control-group">
                <%= f.label :password_confirmation, class: 'control-label' %>
                <div class="controls">
                  <%= f.password_field :password_confirmation %>
                </div>
              </div>

              <div class="control-group">
                <%= f.label :current_password %> <i class: 'control-label'>(we need your current password to confirm your changes)</i>
                <div class="controls">
                  <%= f.password_field :current_password %>
                </div>
              </div>

              <div><%= f.submit "Update", class: "btn btn-primary btn-large" %></div>
            <% end %>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>